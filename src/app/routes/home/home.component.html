<!-- @if (!authService.isLoggedIn()) {
  <div class="welcome-container">
    <div class="welcome-card">
      <h1>Bienvenue sur Triclope</h1>
      <p>Gérez vos participations et triclopes en toute simplicité.</p>
      
      <div class="auth-buttons">
        <a routerLink="/auth/login" class="btn btn-primary">Se connecter</a>
        <a routerLink="/auth/register" class="btn btn-secondary">S'inscrire</a>
      </div>
    </div>
  </div>
} @else { -->
<div class="home-main">
  <!-- Navigation -->
  <div class="nav">
    <div class="nav-left">
      <button class="join-btn">Rejoindre</button>
    </div>
    <div class="nav-right">
      <div class="notification">
        <button class="notification-btn" (click)="toggleNotifications()">
          <!-- <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path
              d="M12 2C11.4477 2 11 2.44772 11 3V4.07089C8.8358 4.19405 7 5.97605 7 8.16667V14H5C4.44772 14 4 14.4477 4 15C4 15.5523 4.44772 16 5 16H7V17C7 18.1046 7.89543 19 9 19H15C16.1046 19 17 18.1046 17 17V16H19C19.5523 16 20 15.5523 20 15C20 14.4477 19.5523 14 19 14H17V8.16667C17 5.97605 15.1642 4.19405 13 4.07089V3C13 2.44772 12.5523 2 12 2Z"
              fill="#333" />
            <path d="M9 20C9 21.1046 9.89543 22 11 22H13C14.1046 22 15 21.1046 15 20H9Z" fill="#333" />
            <circle cx="17" cy="5" r="4" fill="#F44336" />
          </svg> -->
          <svg width="32" height="32" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path fill-rule="evenodd" clip-rule="evenodd"
              d="M11.7009 7.14697C9.62899 7.14697 8.64717 8.38197 7.66632 10.607C7.09252 12.1293 6.80727 13.75 6.82587 15.382C8.24252 16.4412 9.94777 17.0173 11.7009 17.029C13.454 17.0173 15.1592 16.4412 16.5759 15.382C16.5948 13.75 16.3099 12.1294 15.7364 10.607C14.7546 8.38197 13.7727 7.14697 11.7009 7.14697Z"
              stroke="#140900" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" />
            <path
              d="M14.5904 19.2745C14.9209 19.0248 14.9865 18.5545 14.7368 18.224C14.4872 17.8934 14.0168 17.8279 13.6863 18.0775L14.5904 19.2745ZM9.71536 18.0775C9.38484 17.8279 8.91451 17.8934 8.66486 18.224C8.41521 18.5545 8.48078 19.0248 8.81131 19.2745L9.71536 18.0775ZM10.8887 4.75C10.4744 4.75 10.1387 5.08579 10.1387 5.5C10.1387 5.91421 10.4744 6.25 10.8887 6.25V4.75ZM12.513 6.25C12.9272 6.25 13.263 5.91421 13.263 5.5C13.263 5.08579 12.9272 4.75 12.513 4.75V6.25ZM13.6863 18.0775C12.5041 18.9704 10.8975 18.9704 9.71536 18.0775L8.81131 19.2745C10.5285 20.5714 12.8732 20.5714 14.5904 19.2745L13.6863 18.0775ZM10.8887 6.25H12.513V4.75H10.8887V6.25Z"
              fill="#140900" />
            <rect x="15" y="5" width="4" height="4" rx="2" fill="#F44336" />
          </svg>

        </button>
      </div>
      <div class="user-avatar">
        <div class="user-avatar-skeleton">
          <span class="user-avatar-initial">{{ getUserInitial() }}</span>
        </div>
      </div>
    </div>
  </div>

  <!-- Main Content -->
  <div class="content">
    <!-- Greeting and Stats -->
    <div class="greeting-section">
      <p class="greeting">Hey {{ userName() }},</p>
      <div class="stats">
        <p class="stats-text">Cette semaine tu as donné :</p>
        <div class="cigarettes-count">
          <span class="count">
            @for (digit of getDigits(); track $index) {
            <span class="digit" [class.animating]="digitAnimations()[$index]?.isAnimating">
              {{ digit }}
            </span>
            }
          </span>
          <span class="unit">clopes</span>
        </div>
        <div class="equivalents">
          <button class="equiv-btn">5 euros</button>
          <button class="equiv-btn">20g de tabac</button>
        </div>
      </div>
    </div>

    <!-- Progress Section -->
    <div class="progress-section">
      <div class="progress-labels">
        <span>Gros gatteur</span>
        <span>T'es clean</span>
        <span>Tu régales</span>
      </div>
      <div class="progress-bar">
        <div class="progress-track">
          <div class="progress-fill" [style.width.%]="progressFillWidth()" [style.left.%]="progressFillLeft()"></div>
          <div class="progress-end-icon" [class]="getIconPositionClass()" [class.flipped]="shouldFlipIcon()"
            *ngIf="progressRatio() !== 0">
            <svg width="68" height="68" viewBox="0 0 68 68" fill="none" xmlns="http://www.w3.org/2000/svg">
              <g clip-path="url(#clip0_13_29)">
                <path opacity="0.5"
                  d="M44.6405 31.0747C42.3654 31.9656 35.3226 36.9932 33.0263 35.3226C29.3273 32.6365 34.3468 27.1662 36.5344 24.7134C39.1172 21.8231 40.4589 18.6676 40.5862 15.178C40.9044 10.299 36.4682 3.66193 31.1171 4.85517C31.1171 4.85517 34.0392 7.44318 33.0767 10.5164C30.6955 18.1161 21.7223 21.5738 18.4847 28.7678C16.6418 32.7532 17.957 37.6057 21.9504 39.5944C25.3975 41.843 31.8994 40.5384 36.2083 37.3803C41.9226 33.1881 44.6405 31.0747 44.6405 31.0747Z"
                  fill="#BDBDBD" />
                <path
                  d="M34.2885 63.2392L60.919 36.6087L54.7884 30.4781L28.1579 57.1086C28.1579 57.1086 27.2404 59.0602 29.7886 61.6084C32.3369 64.1567 34.2885 63.2392 34.2885 63.2392Z"
                  fill="#EEEEEE" />
                <path
                  d="M34.2885 63.2392L60.919 36.6087L54.7884 30.4781L28.1579 57.1086C28.1579 57.1086 27.2404 59.0602 29.7886 61.6084C32.3369 64.1567 34.2885 63.2392 34.2885 63.2392Z"
                  fill="url(#paint0_linear_13_29)" />
                <path
                  d="M28.1579 57.1086L35.0044 50.262C35.0044 50.262 34.087 52.2136 36.6352 54.7619C39.1834 57.3101 41.1351 56.3926 41.1351 56.3926L34.2885 63.2392C34.2885 63.2392 32.3369 64.1567 29.7886 61.6084C27.2404 59.0602 28.1579 57.1086 28.1579 57.1086Z"
                  fill="#F19534" />
                <path
                  d="M31.0376 62.6293C31.0243 62.6108 30.9686 62.5126 30.9872 62.2713C31.0058 62.03 31.0959 61.8073 31.2868 61.6535C31.3452 61.6058 31.4115 61.566 31.4857 61.5607C31.6103 61.5474 31.7244 61.6243 31.7986 61.7251C31.8702 61.8232 32.0426 62.4676 32.8725 63.3665C32.3634 63.2869 31.7403 63.0827 31.0376 62.6293Z"
                  fill="#FFCC80" />
                <path
                  d="M34.8374 57.1961C34.8347 57.4109 34.8453 57.6389 34.9753 57.8113C35.1211 58.0049 35.3757 58.0738 35.6143 58.1056C35.8795 58.1374 36.1473 58.1401 36.4125 58.103C36.5106 58.0897 36.6166 58.0685 36.6829 57.9969C36.8129 57.8564 36.7174 57.6283 36.614 57.4666C36.2454 56.87 35.845 56.2945 35.4154 55.7377C35.3757 55.6873 35.3306 55.6316 35.267 55.6263C34.8268 55.5733 34.8427 56.984 34.8374 57.1961Z"
                  fill="#FFCC80" />
                <path
                  d="M32.085 58.7393C31.841 58.803 31.5891 58.8428 31.3399 58.8162C31.088 58.7871 30.844 58.681 30.6849 58.4848C30.6398 58.4291 30.6001 58.3575 30.616 58.2886C30.6345 58.217 30.7035 58.1745 30.7671 58.1374C31.1967 57.8935 31.6395 57.6734 32.0956 57.4825C32.1592 57.456 32.2282 57.4294 32.2998 57.4321C32.3714 57.4347 32.4403 57.4719 32.5039 57.5037C32.6763 57.6018 32.8327 57.7211 32.9759 57.8537C33.5593 58.3999 32.4748 58.6412 32.085 58.7393Z"
                  fill="#FFCC80" />
                <path
                  d="M32.2043 55.1199C32.3104 55.1994 32.4642 55.1623 32.5888 55.1172C32.9096 54.9926 33.2172 54.8123 33.4426 54.5551C33.7449 54.2156 33.9915 52.7546 33.265 53.3379C32.9998 53.5501 31.8941 54.8839 32.2043 55.1199Z"
                  fill="#FFCC80" />
                <path
                  d="M34.7128 59.4739C34.5086 59.5083 34.3786 59.7761 34.3495 59.9856C34.2381 60.8076 33.9915 60.7891 33.5593 60.9986C33.0793 61.2293 33.3578 61.4546 33.6998 61.5209C34.0896 61.5978 35.1582 61.383 35.4314 60.9455C35.6037 60.6777 34.9328 59.4394 34.7128 59.4739Z"
                  fill="#FFCC80" />
                <path
                  d="M29.672 61.4918C28.6988 60.4868 28.2348 59.5242 28.0969 58.8454C28.1579 58.8003 28.2321 58.7685 28.3196 58.75C28.5477 58.7075 29.4121 59.0682 29.5076 59.222C29.6985 59.5242 29.664 60.9694 29.672 61.4918Z"
                  fill="#FFCC80" />
                <path
                  d="M30.4065 55.8888C30.4463 56.4908 29.9663 56.4298 29.7886 56.3635C29.5845 56.2866 29.4227 56.1407 29.2981 55.9684L30.4887 54.7778C30.4463 55.0854 30.3694 55.3638 30.4065 55.8888Z"
                  fill="#FFCC80" />
                <path
                  d="M38.7512 57.5939C38.3588 57.6628 37.969 57.9518 37.9955 58.3549C38.0194 58.7341 38.0963 59.1292 38.0459 59.4818L39.7323 57.7954C39.3081 57.6575 38.9262 57.562 38.7512 57.5939Z"
                  fill="#FFCC80" />
                <path
                  d="M55.2418 34.3256C55.1835 33.9491 55.3744 33.5513 55.2498 33.1934C55.0907 32.732 54.4941 32.5596 54.2846 32.1168C54.0645 31.6581 54.3429 31.1304 54.6134 30.7008C54.7805 30.433 55.0456 30.1731 55.3267 30.0299C55.4354 29.9743 55.5521 29.9318 55.6635 29.8735C56.1116 29.6428 56.3502 29.1814 56.74 28.8765C56.9813 28.6882 57.2783 28.545 57.5806 28.5822C57.745 28.6034 57.9014 28.675 58.0658 28.6962C58.3681 28.728 58.6174 28.5265 58.9091 28.4787C59.1875 28.4337 59.4818 28.3674 59.755 28.4761C60.1951 28.6511 60.3701 29.1867 60.7599 29.4545C60.9774 29.603 61.2399 29.6587 61.4759 29.7727C61.5077 29.7887 61.5395 29.8046 61.5687 29.8231C61.9346 30.0353 62.2104 30.4012 62.3085 30.8122C62.3933 31.1834 62.3456 31.5865 62.51 31.9312C62.6559 32.2361 62.9873 32.3979 63.1278 32.7028C63.2551 32.9786 63.1491 33.3021 62.982 33.5381C62.6453 34.0074 62.3085 34.4609 62.0248 34.9726C61.863 35.267 61.7569 35.5905 61.6111 35.8901C61.3035 36.5265 60.6088 37.0462 59.9379 37.261C59.6674 37.3459 59.3466 37.322 59.1424 37.1284C59.0814 37.0727 59.0311 37.0011 58.9568 36.964C58.8693 36.9189 58.7685 36.9295 58.6704 36.9216C58.3204 36.8845 58.0605 36.5769 57.8723 36.2772C57.684 35.9776 57.5037 35.6435 57.1882 35.487C56.9946 35.3889 56.7745 35.3704 56.5597 35.3306C56.268 35.2829 55.979 35.1954 55.7324 35.0336C55.7032 35.0151 55.6767 34.9938 55.6475 34.97C55.4407 34.8109 55.2816 34.5828 55.2418 34.3256Z"
                  fill="#607D8B" />
                <path
                  d="M62.4225 32.5861C62.8362 33.1218 62.1308 34.3946 61.5607 33.6388C61.2187 33.1801 61.3857 32.8646 61.2717 32.5172C61.2293 32.2785 61.1497 32.1353 60.9058 32.0876C60.5239 31.955 60.0546 31.6607 60.0546 31.2577C60.0864 30.5046 61.1258 30.3243 61.3831 31.0482C61.4944 31.3558 61.1948 31.7403 61.3353 32.0399C61.5448 32.4668 62.1653 32.1645 62.4225 32.5861Z"
                  fill="#F44336" />
                <path
                  d="M56.7771 30.4303C56.9018 30.73 57.2942 30.9845 57.4268 31.2444C57.6867 31.7482 57.2094 32.0982 57.57 32.846C57.7927 33.3074 58.2674 33.8881 59.0337 33.8907C59.2724 33.8907 59.5216 33.7369 59.5375 33.5831C59.6012 33.1536 59.3201 32.8672 58.8375 32.5596C58.7367 32.496 58.7897 32.4323 58.7818 32.3766C58.8587 32.0929 58.8481 31.7959 58.5882 31.6103C58.1984 31.3319 57.737 31.5069 57.5488 31.1277C57.4241 30.8811 57.4188 30.6265 57.6495 30.4118C57.8192 30.2527 57.9386 30.425 58.2568 30.303C58.4795 30.2182 58.4477 29.7727 58.6731 29.6746C58.8985 29.5765 59.2511 30.2898 59.7417 30.0856C59.93 30.0087 59.93 29.7435 59.869 29.5659C59.7815 29.2822 59.3917 29.0196 59.0867 29.1125C58.8269 29.1867 58.8454 29.4863 58.5776 29.542C58.3098 29.5977 57.8935 29.1071 57.501 29.1231C56.7665 29.2 56.4775 29.8602 56.7771 30.4303Z"
                  fill="#F44336" />
                <path opacity="0.5"
                  d="M50.7659 25.4797C46.4967 24.9388 42.7446 27.3597 39.0694 29.1576C37.7197 29.8178 35.4473 30.8599 34.6173 29.5208C33.3949 27.5506 36.6988 24.6657 37.6959 23.2391C40.0426 19.8847 41.2597 16.0902 40.2388 12.126C39.5441 8.98645 35.9882 3.8502 31.1198 4.85783C31.1198 4.85783 35.6037 5.66128 35.3439 12.6775C35.0548 20.5238 25.5115 24.5092 23.8834 32.077C22.258 41.44 31.4327 40.8725 37.1708 36.6723C39.7535 34.7844 42.2912 32.8354 44.8421 30.9262C48.1513 28.4443 51.0151 26.8321 55.2286 27.7946C54.1547 26.4131 52.5159 25.6918 50.7659 25.4797Z"
                  fill="#BDBDBD" />
                <path
                  d="M54.6479 31.2444C54.5471 31.5785 54.5551 32.0054 54.8388 32.2043C54.9687 32.2971 55.1305 32.321 55.279 32.3846C55.6475 32.541 55.8915 32.9494 55.8597 33.3471C55.8279 33.6919 55.6157 34.0366 55.7377 34.3601C55.8544 34.673 56.2309 34.8003 56.5677 34.8188C57.0131 34.8453 57.6257 34.7737 57.9545 35.145C58.1162 35.3279 58.1984 35.5639 58.2541 35.7999C58.278 35.9086 58.2992 36.02 58.3549 36.1181C58.4106 36.2162 58.5034 36.2984 58.6147 36.3037C58.7022 36.3064 58.7844 36.2613 58.8719 36.2428C59.0894 36.2003 59.2989 36.3409 59.4606 36.492C59.6118 36.6325 59.861 36.9401 60.0838 36.956C60.2747 36.972 60.8846 36.6432 61.0171 36.5106C60.6724 36.8553 60.158 37.6508 59.5826 37.4201C59.4686 37.375 59.3731 37.2955 59.2617 37.253C58.9595 37.1311 58.62 37.2689 58.2965 37.2848C57.9916 37.2981 57.6814 37.1947 57.4427 37.0038C57.273 36.8659 57.1404 36.6856 56.9787 36.5344C56.5358 36.1128 56.1514 36.4019 55.6157 36.3647C55.3612 36.3488 55.1172 36.2428 54.9183 36.081C54.7672 35.9617 54.6399 35.8132 54.5445 35.6435C54.3244 35.2537 54.274 34.7843 54.3297 34.3415C54.3827 33.9173 54.5179 33.432 54.2395 33.1058C54.152 33.0024 54.03 32.9335 53.9266 32.8407C53.4546 32.4111 53.8285 31.8622 53.9903 31.4724C54.152 31.0826 54.9104 30.3508 54.9104 30.3508C54.8839 30.6584 54.738 30.9474 54.6479 31.2444Z"
                  fill="#424242" />
                <path
                  d="M28.1579 57.1086L35.0044 50.262C35.0044 50.262 34.087 52.2136 36.6352 54.7619C39.1834 57.3101 41.1351 56.3926 41.1351 56.3926L34.2885 63.2392C34.2885 63.2392 32.3369 64.1567 29.7886 61.6084C27.2404 59.0602 28.1579 57.1086 28.1579 57.1086Z"
                  fill="url(#paint1_linear_13_29)" />
              </g>
              <defs>
                <linearGradient id="paint0_linear_13_29" x1="48.6591" y1="52.4138" x2="44.859" y2="48.6138"
                  gradientUnits="userSpaceOnUse">
                  <stop stop-color="#BDBDBD" />
                  <stop offset="1" stop-color="#BDBDBD" stop-opacity="0" />
                </linearGradient>
                <linearGradient id="paint1_linear_13_29" x1="38.7666" y1="62.3064" x2="34.9665" y2="58.5063"
                  gradientUnits="userSpaceOnUse">
                  <stop stop-color="#A15D38" />
                  <stop offset="1" stop-color="#A15D38" stop-opacity="0" />
                </linearGradient>
                <clipPath id="clip0_13_29">
                  <rect width="48" height="48" fill="white"
                    transform="matrix(-0.707107 0.707107 0.707107 0.707107 33.9411 0)" />
                </clipPath>
              </defs>
            </svg>

          </div>
        </div>
      </div>
      <div class="progress-values">
        <span>-100</span>
        <span>0</span>
        <span>100</span>
      </div>
      <div class="progress-stats">
        <span>Données: {{ cigarettesGiven() }} données, {{ cigarettesReceived() }} reçues</span>
        <span>Ratio: {{ progressRatio() }}</span>
      </div>
      <div class="test-buttons">
        <button (click)="testPositiveRatio()">Test +Ratio</button>
        <button (click)="testNegativeRatio()">Test -Ratio</button>
        <button (click)="testBalancedRatio()">Test Balanced</button>
        <button (click)="testExtremePositive()">Test +Extreme</button>
        <button (click)="testExtremeNegative()">Test -Extreme</button>
      </div>
    </div>

    <!-- Create Button -->
    <div class="create-section">
      <button class="create-btn" (click)="onCreateTriclope()">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M12 4V20M20 12H4" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
        </svg>
        Créer un TriClope
      </button>
    </div>

    <!-- TriClopes List -->
    <div class="triclopes-section">
      <h2 class="section-title">Tes TriClopes</h2>
      <div class="triclopes-list">
        @for (triclope of triclopes(); track triclope.id; let i = $index) {
        <app-triclope-card [triclope]="triclope" [participations]="getParticipationsForTriclope(triclope.id)"
          [backgroundColor]="getCardVariation(i).backgroundColor" [textColor]="getCardVariation(i).textColor"
          [borderColor]="getCardVariation(i).borderColor" [avatarColor]="getCardVariation(i).avatarColor"
          [showParticipantName]="true" [participantName]="getCardVariation(i).participantName"
          [participantCount]="getCardVariation(i).participantCount"
          (deleteParticipationEvent)="onDeleteParticipation($event)">
        </app-triclope-card>
        }
        @if (triclopes().length === 0) {
        <p class="no-triclopes">Aucun triclope trouvé.</p>
        }
      </div>
    </div>
  </div>
</div>
<!-- } -->